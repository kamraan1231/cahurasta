<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Route Planner & Task Manager</title>
    <script src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_api_key }}&libraries=geometry&callback=initMap" async defer></script>
</head>
<body>
    <h1>ğŸš— Route Planner</h1>
    <input type="text" id="start" placeholder="Start Location">
    <input type="text" id="end" placeholder="Destination">
    <button onclick="findRoute()">Find Route</button>

    <h2>ğŸ“… Task Planner</h2>
    <input type="text" id="task_name" placeholder="Task Name">
    <input type="date" id="task_date">
    <input type="time" id="task_time">
    <input type="number" id="reminder_time" placeholder="Reminder (mins before)">
    <button onclick="addTask()">Add Task</button>

    <h3>ğŸ“Œ Planned Tasks</h3>
    <ul id="task_list"></ul>

    <div id="map" style="height: 400px; width: 100%;"></div>

    <script>
        let map;
        let directionsService;
        let directionsRenderer;

        function initMap() {
            map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: 37.7749, lng: -122.4194 },
                zoom: 12,
            });

            directionsService = new google.maps.DirectionsService();
            directionsRenderer = new google.maps.DirectionsRenderer();
            directionsRenderer.setMap(map);
        }

        function findRoute() {
            let start = document.getElementById("start").value;
            let end = document.getElementById("end").value;

            fetch("/get_route", {
                method: "POST",
                body: JSON.stringify({ start, end, mode: "driving" }),
                headers: { "Content-Type": "application/json" }
            })
            .then(response => response.json())
            .then(data => {
                if (data.route) {
                    let decodedPath = google.maps.geometry.encoding.decodePath(data.route);
                    let routePolyline = new google.maps.Polyline({
                        path: decodedPath,
                        geodesic: true,
                        strokeColor: "#FF0000",
                        strokeOpacity: 1.0,
                        strokeWeight: 4
                    });
                    routePolyline.setMap(map);
                } else {
                    alert("No route found!");
                }
            })
            .catch(error => console.error("Error fetching route:", error));
        }

        function addTask() {
            let task = document.getElementById("task_name").value;
            let date = document.getElementById("task_date").value;
            let time = document.getElementById("task_time").value;
            let reminder_time = document.getElementById("reminder_time").value;

            fetch("/add_task", {
                method: "POST",
                body: JSON.stringify({ task, date, time, reminder_time }),
                headers: { "Content-Type": "application/json" }
            }).then(() => loadTasks());
        }

        function loadTasks() {
            fetch("/get_tasks").then(response => response.json()).then(tasks => {
                let taskList = document.getElementById("task_list");
                taskList.innerHTML = "";
                tasks.forEach(task => {
                    taskList.innerHTML += `<li>${task[1]} - ${task[2]} at ${task[3]}</li>`;
                });
            });
        }

        loadTasks();
    </script>
</body>
</html>
